<!DOCTYPE html>
<html lang="en">
  <head th:replace="fragments :: common_header(~{::title},~{})">
  	<title>KT Home Automation App - Home</title>
  </head>
  <body>
    <nav th:replace="fragments :: common_navigation(${navigationElements})">
    </nav>
    <div class="container-fluid">
      <div class="row"><!-- space --> &nbsp;</div>
      <div class="row">
        <div class="col-lg-12">
          <h1 class="display-4">Home</h1>
          <!-- 
          <canvas id="tempLogger" width="980" height="640"></canvas>
           -->
        </div>
      </div>
    </div>
    <!--  
    <script src="/static/js/Chart.min.js" th:src="@{/static/js/Chart.min.js}"></script>
    <script src="/static/js/stomp.min.js" th:src="@{/static/js/stomp.min.js}"></script>
    <script src="/static/js/sockjs.min.js" th:src="@{/static/js/sockjs.min.js}"></script>
    <script type="text/javascript">
    	// test data
		var data = {
		    labels: [],
		    datasets: [
		        {
		            label: "Sensor 0",
		            fillColor: "rgba(220,220,220,0.2)",
		            strokeColor: "rgba(220,220,220,1)",
		            pointColor: "rgba(220,220,220,1)",
		            pointStrokeColor: "#fff",
		            pointHighlightFill: "#fff",
		            pointHighlightStroke: "rgba(220,220,220,1)",
		            data: []
		        },
		        {
		            label: "Sensor 1",
		            fillColor: "rgba(151,187,205,0.2)",
		            strokeColor: "rgba(151,187,205,1)",
		            pointColor: "rgba(151,187,205,1)",
		            pointStrokeColor: "#fff",
		            pointHighlightFill: "#fff",
		            pointHighlightStroke: "rgba(151,187,205,1)",
		            data: []
		        }
		    ]
		};
    	var options = {

   		    ///Boolean - Whether grid lines are shown across the chart
   		    scaleShowGridLines : true,

   		    //String - Colour of the grid lines
   		    scaleGridLineColor : "rgba(0,0,0,.05)",

   		    //Number - Width of the grid lines
   		    scaleGridLineWidth : 1,

   		    //Boolean - Whether to show horizontal lines (except X axis)
   		    scaleShowHorizontalLines: true,

   		    //Boolean - Whether to show vertical lines (except Y axis)
   		    scaleShowVerticalLines: true,

   		    //Boolean - Whether the line is curved between points
   		    bezierCurve : true,

   		    //Number - Tension of the bezier curve between points
   		    bezierCurveTension : 0.4,

   		    //Boolean - Whether to show a dot for each point
   		    pointDot : true,

   		    //Number - Radius of each point dot in pixels
   		    pointDotRadius : 4,

   		    //Number - Pixel width of point dot stroke
   		    pointDotStrokeWidth : 1,

   		    //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
   		    pointHitDetectionRadius : 20,

   		    //Boolean - Whether to show a stroke for datasets
   		    datasetStroke : true,

   		    //Number - Pixel width of dataset stroke
   		    datasetStrokeWidth : 2,

   		    //Boolean - Whether to fill the dataset with a colour
   		    datasetFill : true,

   		    //String - A legend template
   		    legendTemplate : "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].strokeColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>"

    	};
    	    	
    	$(document).ready(function(){
    	 	// Get context with jQuery - using jQuery's .get() method.
    	    var ctx = $("#tempLogger").get(0).getContext("2d");
    	    // This will get the first returned node in the jQuery collection.
    	    var tempLogger = new Chart(ctx).Line(data, options);
    	    // var date = new Date();
    	    // tempLogger.addData([40, 60], date.toLocaleDateString()+ " " + date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds());
            var socket = new SockJS('/temperatures');
            var stompClient = Stomp.over(socket);
            stompClient.connect({}, function(frame) {
                stompClient.subscribe('/data/temperatures', function(data){
                    var sensorData = JSON.parse(data.body);
                    var graphContent = [];
                    var dataCaptureDate = undefined;
                    $.each(sensorData, function(index, value){
                    	if(dataCaptureDate === undefined){
                    		dataCaptureDate = new Date(value.dataTimestamp);
                    	}
                    	graphContent.push(value.temperature);
                    });
                    //console.log(graphContent);
                    //console.log(dataCaptureDate);
                    tempLogger.addData([graphContent[0], graphContent[1]], dataCaptureDate.getHours() + ":" + dataCaptureDate.getMinutes() + ":" + dataCaptureDate.getSeconds());
                });
            });
    	});
    </script>
    -->
  </body>
</html>
